# FastAPI GitHub Repo Activity Tracker


Этот проект представляет собой приложение на основе FastAPI, предназначенное для получения и управления данными и активностью репозиториев GitHub. Оно позволяет пользователям получать топ-100 репозиториев, отсортированных по звездами, форкам или наблюдателям, а также отслеживать активность репозиториев в заданный период времени. Приложение интегрируется с Yandex Cloud Functions для получения данных и активности репозиториев.

## Функционал

- **Получение топ-100 репозиториев**: Получает топ-100 репозиториев, отсортированных по звездами, форкам или наблюдателям.
- **Отслеживание активности репозиториев**: Получает активность репозиториев (коммиты и авторы) за заданный период времени.
- **Периодические обновления данных**: Запланированные задачи для обновления позиций топ-100 репозиториев раз в сутки в 02:00.
- **Интеграция с базой данных**: Хранит данные репозиториев и активность в базе данных PostgreSQL.

## Требования

- Python 3.12+
- PostgreSQL database
- Docker

## УСТАНОВКА

### 1. Клонирование репозитория:

```bash
git clone <your-repo-url>
cd <your-project-directory>
```

### 2. Настройка переменных окружения:

- Создайте файл **.env** в корне директории проекта и добавьте свои данные для подключения к PostgreSQL.

```bash
DB_HOST=YOUR_DB_HOST
DB_NAME=YOUR_DB_NAME
DB_USER=YOUR_DB_USER
DB_PASSWORD=YOUR_DB_PASSWORD
DB_PORT=YOUR_DB_PORT
```

### 3. Запуск с помощью Docker:

- Если вы хотите запустить приложение внутри контейнера Docker, вы можете использовать предоставленный файл **docker-compose.yml**.

```bash
docker-compose up --build
```

### 4. Запланированные задачи:

- Приложение включает запланированную задачу, которая обновляет позиции топ-100 репозиториев. Эта задача выполняется ежедневно в 02:00. Время и количество обновления было выбрано в период наименьшей активности, так как данные о позициях меняются редко и нет необходимости обновлять их чаще. Задача может быть изменена по мере необходимости, отредактировав расписание в файле app/tasks/schedule_top100.py. 


## Схема базы данных

Приложение использует PostgreSQL с двумя основными таблицами:

## top100
Хранит информацию о топ-100 репозиториях.

### Столбцы:
- `repo` — название репозитория
- `owner` — владелец репозитория
- `position_cur` — текущая позиция
- `position_prev` — предыдущая позиция
- `stars` — количество звезд
- `watchers` — количество наблюдателей
- `forks` — количество форков
- `open_issues` — количество открытых задач
- `language` — язык программирования

## activity
Хранит данные активности для каждого репозитория.

### Столбцы:
- `date` — дата активности
- `commits` — количество коммитов
- `authors` — авторы коммитов
- `repo` — название репозитория
- `owner` — владелец репозитория

Измена структура таблицы **activity** (добавлены поля `repo` и `owner`) для более понятной логики работы метода `GET /api/repos/{owner}/{repo}/activity`. Так как при заданой структуре смысла использования таблицы вообще не было из-за отсутствия нужных полей для повторого извлечения данных, в следствии чего пришлось бы делать каждый раз запросы к Github.


## Yandex Cloud Functions

Были созданы две публичные функции для получения топ 100 репозиториев и активности репозиториев. 

Для получения топ 100:
- "https://functions.yandexcloud.net/d4ed8hfm7qsjr6eo7gvj".

Aктивности:
- "https://functions.yandexcloud.net/d4ei370aq9gh79u190b7".
